{"ast":null,"code":"var _jsxFileName = \"/Users/linhleba/Desktop/ToLiShop/src/components/login/Login.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport './login.css';\nimport PropTypes from 'prop-types';\nimport callAPI from '../../utils/apiCaller';\nimport { Avatar, Button, Paper, Grid, Typography, Container } from '@material-ui/core';\nimport './login.css';\nimport useStyles from './style.js';\nimport LockOutlinedIcon from '@material-ui/icons/LockOutlined';\nimport Controls from '../../components/controls/Controls';\nimport Input from './Input';\nimport { GoogleLogin } from 'react-google-login';\nimport Icon from './icon';\nimport { useDispatch } from 'react-redux'; // import { AUTH } from '../../constants/actionTypes';\n\nimport { authenticate } from '../../redux/ducks/auth';\nimport { signIn, signUp } from '../../redux/actions/auth';\nimport { useHistory } from 'react-router-dom';\nimport * as api from '../../api/index';\nimport { setSnackbar } from '../redux/ducks/snackbar'; // require('dotenv').config();\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst loginUser = async credentials => {\n  let res;\n  await callAPI('api/account/login', 'POST', credentials).then(response => {\n    console.log(response);\n    res = response.data.access_jwt_token; // return response;\n    // get data from call api\n    // setBooks(response.data);\n  });\n  return res;\n}; // console.log('responseStatus', responseStatus);\n\n\nconst initialState = {\n  name: '',\n  username: '',\n  password: '',\n  confirmPassword: ''\n};\n\nconst Login = ({\n  setToken\n}) => {\n  _s();\n\n  const dispatch = useDispatch();\n  const history = useHistory();\n  const classes = useStyles();\n  const [form, setForm] = useState(initialState);\n  const [isSignedUp, setIsSignedUp] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n\n  const handleShowPassword = () => setShowPassword(!showPassword); // const [username, setUserName] = useState();\n  // const [password, setPassword] = useState();\n\n\n  const switchMode = () => {\n    setForm(initialState);\n    setIsSignedUp(prevIsSignedUp => !prevIsSignedUp);\n    setShowPassword(false);\n  };\n\n  const handleSubmit = async e => {\n    e.preventDefault(); // const token = await loginUser({\n    //   username,\n    //   password,\n    // });\n    // setToken(token);\n\n    if (isSignedUp) {\n      // dispatch(signUp(form, history));\n      if (form.password === form.confirmPassword) {\n        const {\n          data\n        } = await api.signUp(form); // console.log(data);\n\n        if (!data) {\n          dispatch(setSnackbar(true, 'error', 'Đã có lỗi xảy ra'));\n        } else {\n          // account is exsited\n          if (data.message != 'successfully created') {\n            dispatch(setSnackbar(true, 'error', 'Tên đăng nhập đã tồn tại!'));\n          } else {\n            const {\n              data\n            } = await api.signIn(form);\n            setToken(data.access_jwt_token);\n            dispatch(authenticate({\n              access_jwt_token: data.access_jwt_token\n            }));\n          }\n        }\n      } else {\n        dispatch(setSnackbar(true, 'error', 'Mật khẩu không khớp'));\n      }\n    } else {\n      // console.log(form);\n      const {\n        data\n      } = await api.signIn(form);\n\n      if (!data) {\n        dispatch(setSnackbar(true, 'error', 'Đã có lỗi xảy ra'));\n      } else {\n        if (!data.access_jwt_token) {\n          dispatch(setSnackbar(true, 'error', 'Thông tin đăng nhập không chính xác!'));\n        } else {\n          setToken(data.access_jwt_token);\n          dispatch(authenticate({\n            access_jwt_token: data.access_jwt_token\n          })); // history.push('/');\n        }\n      } // dispatch(signIn(form, history));\n\n    }\n  };\n\n  const googleSuccess = async res => {\n    const result = res === null || res === void 0 ? void 0 : res.profileObj;\n    const token = res === null || res === void 0 ? void 0 : res.tokenId;\n    const googleData = {\n      result,\n      token\n    };\n\n    try {\n      dispatch(authenticate(googleData));\n      const profile = localStorage.getItem('profile');\n      const token = JSON.parse(profile).token;\n      const profileData = JSON.parse(profile).result;\n      let isExistedAccount = null;\n      await callAPI('api/account/loginGoogle', 'post', {\n        token: token\n      }).then(res => {\n        // console.log(res);\n        isExistedAccount = res.isExistedAccount;\n      });\n\n      if (!isExistedAccount) {\n        const payload = {\n          username: profileData.googleId,\n          password: profileData.email + 'ToLiShop',\n          photo: profileData.imageUrl,\n          name: profileData.name,\n          email: profileData.email\n        };\n        const {\n          data\n        } = await api.signUp(payload);\n      } // handle login\n\n\n      const {\n        data\n      } = await api.signIn({\n        username: profileData.googleId,\n        password: profileData.email + 'ToLiShop'\n      });\n      setToken(data.access_jwt_token);\n      dispatch(authenticate({\n        access_jwt_token: data.access_jwt_token\n      })); // sign up data in database\n      // const { res } = await api.signUp(form);\n      // // console.log(res);\n      // if (!res) {\n      //   dispatch(setSnackbar(true, 'error', 'Đã có lỗi xảy ra'));\n      // } else {\n      //   // account is exsited\n      //   if (res.message != 'successfully created') {\n      //     dispatch(setSnackbar(true, 'error', 'Tên đăng nhập đã tồn tại!'));\n      //   } else {\n      //     const { res } = await api.signIn(form);\n      //     setToken(res.access_jwt_token);\n      //     dispatch(authenticate({ access_jwt_token: res.access_jwt_token }));\n      //   }\n      // }\n      // history.push('/');\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const googleError = () => {\n    alert('Đã có lỗi xảy ra trong quá trình đăng nhập. Thử lại sau!');\n  };\n\n  const handleChange = e => setForm({ ...form,\n    [e.target.name]: e.target.value\n  });\n\n  return /*#__PURE__*/_jsxDEV(Container, {\n    component: \"main\",\n    maxWidth: \"xs\",\n    children: /*#__PURE__*/_jsxDEV(Paper, {\n      className: classes.paper,\n      elevation: 3,\n      children: [/*#__PURE__*/_jsxDEV(Avatar, {\n        className: classes.avatar,\n        children: /*#__PURE__*/_jsxDEV(LockOutlinedIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h5\",\n        children: isSignedUp ? 'Đăng kí' : 'Đăng nhập'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        className: classes.form,\n        onSubmit: handleSubmit,\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          spacing: 2,\n          children: [isSignedUp && /*#__PURE__*/_jsxDEV(Input, {\n            name: \"name\",\n            label: \"H\\u1ECD t\\xEAn\",\n            autoFocus: true,\n            handleChange: handleChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            name: \"username\",\n            label: \"T\\xEAn \\u0111\\u0103ng nh\\u1EADp\",\n            type: \"text\",\n            handleChange: handleChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            name: \"password\",\n            label: \"M\\u1EADt kh\\u1EA9u\",\n            type: showPassword ? 'text' : 'password',\n            handleShowPassword: handleShowPassword,\n            handleChange: handleChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 206,\n            columnNumber: 13\n          }, this), isSignedUp && /*#__PURE__*/_jsxDEV(Input, {\n            name: \"confirmPassword\",\n            label: \"Repeat Password\" // handleChange={handleChange}\n            ,\n            type: \"password\",\n            handleChange: handleChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 214,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          type: \"submit\",\n          fullWidth: true,\n          variant: \"contained\",\n          color: \"primary\",\n          className: classes.submit,\n          children: isSignedUp ? 'Đăng kí' : 'Đăng nhập'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(GoogleLogin, {\n          clientId: \"760325754105-f20dtj8ttufvs00sufb4sc9fniq83apk.apps.googleusercontent.com\",\n          render: renderProps => /*#__PURE__*/_jsxDEV(Button, {\n            className: classes.googleButton,\n            color: \"primary\",\n            fullWidth: true,\n            onClick: renderProps.onClick,\n            disabled: renderProps.disabled,\n            startIcon: /*#__PURE__*/_jsxDEV(Icon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 241,\n              columnNumber: 28\n            }, this),\n            variant: \"contained\",\n            children: \"\\u0110\\u0103ng nh\\u1EADp Google\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 15\n          }, this),\n          onSuccess: googleSuccess,\n          onFailure: googleError,\n          cookiePolicy: \"single_host_origin\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          justify: \"flex-end\",\n          children: /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              onClick: switchMode,\n              children: isSignedUp ? 'Đã có tài khoản? Đăng nhập' : 'Chưa có tài khoản? Đăng kí'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 253,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 252,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 182,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Login, \"FU3A6/mRFIAWXRRFyqjzrvQkNsU=\", false, function () {\n  return [useDispatch, useHistory, useStyles];\n});\n\n_c = Login;\nexport default Login;\nLogin.propTypes = {\n  setToken: PropTypes.func.isRequired\n};\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"sources":["/Users/linhleba/Desktop/ToLiShop/src/components/login/Login.jsx"],"names":["React","useState","PropTypes","callAPI","Avatar","Button","Paper","Grid","Typography","Container","useStyles","LockOutlinedIcon","Controls","Input","GoogleLogin","Icon","useDispatch","authenticate","signIn","signUp","useHistory","api","setSnackbar","loginUser","credentials","res","then","response","console","log","data","access_jwt_token","initialState","name","username","password","confirmPassword","Login","setToken","dispatch","history","classes","form","setForm","isSignedUp","setIsSignedUp","showPassword","setShowPassword","handleShowPassword","switchMode","prevIsSignedUp","handleSubmit","e","preventDefault","message","googleSuccess","result","profileObj","token","tokenId","googleData","profile","localStorage","getItem","JSON","parse","profileData","isExistedAccount","payload","googleId","email","photo","imageUrl","error","googleError","alert","handleChange","target","value","paper","avatar","submit","renderProps","googleButton","onClick","disabled","propTypes","func","isRequired"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport './login.css';\nimport PropTypes from 'prop-types';\nimport callAPI from '../../utils/apiCaller';\nimport {\n  Avatar,\n  Button,\n  Paper,\n  Grid,\n  Typography,\n  Container,\n} from '@material-ui/core';\nimport './login.css';\nimport useStyles from './style.js';\nimport LockOutlinedIcon from '@material-ui/icons/LockOutlined';\nimport Controls from '../../components/controls/Controls';\nimport Input from './Input';\nimport { GoogleLogin } from 'react-google-login';\nimport Icon from './icon';\nimport { useDispatch } from 'react-redux';\n// import { AUTH } from '../../constants/actionTypes';\nimport { authenticate } from '../../redux/ducks/auth';\nimport { signIn, signUp } from '../../redux/actions/auth';\nimport { useHistory } from 'react-router-dom';\nimport * as api from '../../api/index';\nimport { setSnackbar } from '../redux/ducks/snackbar';\n// require('dotenv').config();\n\nconst loginUser = async (credentials) => {\n  let res;\n  await callAPI('api/account/login', 'POST', credentials).then((response) => {\n    console.log(response);\n    res = response.data.access_jwt_token;\n    // return response;\n    // get data from call api\n    // setBooks(response.data);\n  });\n  return res;\n};\n// console.log('responseStatus', responseStatus);\n\nconst initialState = {\n  name: '',\n  username: '',\n  password: '',\n  confirmPassword: '',\n};\n\nconst Login = ({ setToken }) => {\n  const dispatch = useDispatch();\n  const history = useHistory();\n  const classes = useStyles();\n  const [form, setForm] = useState(initialState);\n  const [isSignedUp, setIsSignedUp] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n  const handleShowPassword = () => setShowPassword(!showPassword);\n  // const [username, setUserName] = useState();\n  // const [password, setPassword] = useState();\n\n  const switchMode = () => {\n    setForm(initialState);\n    setIsSignedUp((prevIsSignedUp) => !prevIsSignedUp);\n    setShowPassword(false);\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    // const token = await loginUser({\n    //   username,\n    //   password,\n    // });\n    // setToken(token);\n    if (isSignedUp) {\n      // dispatch(signUp(form, history));\n      if (form.password === form.confirmPassword) {\n        const { data } = await api.signUp(form);\n        // console.log(data);\n        if (!data) {\n          dispatch(setSnackbar(true, 'error', 'Đã có lỗi xảy ra'));\n        } else {\n          // account is exsited\n          if (data.message != 'successfully created') {\n            dispatch(setSnackbar(true, 'error', 'Tên đăng nhập đã tồn tại!'));\n          } else {\n            const { data } = await api.signIn(form);\n            setToken(data.access_jwt_token);\n            dispatch(authenticate({ access_jwt_token: data.access_jwt_token }));\n          }\n        }\n      } else {\n        dispatch(setSnackbar(true, 'error', 'Mật khẩu không khớp'));\n      }\n    } else {\n      // console.log(form);\n      const { data } = await api.signIn(form);\n\n      if (!data) {\n        dispatch(setSnackbar(true, 'error', 'Đã có lỗi xảy ra'));\n      } else {\n        if (!data.access_jwt_token) {\n          dispatch(\n            setSnackbar(true, 'error', 'Thông tin đăng nhập không chính xác!'),\n          );\n        } else {\n          setToken(data.access_jwt_token);\n          dispatch(authenticate({ access_jwt_token: data.access_jwt_token }));\n          // history.push('/');\n        }\n      }\n      // dispatch(signIn(form, history));\n    }\n  };\n  const googleSuccess = async (res) => {\n    const result = res?.profileObj;\n    const token = res?.tokenId;\n    const googleData = {\n      result,\n      token,\n    };\n\n    try {\n      dispatch(authenticate(googleData));\n\n      const profile = localStorage.getItem('profile');\n      const token = JSON.parse(profile).token;\n      const profileData = JSON.parse(profile).result;\n      let isExistedAccount = null;\n      await callAPI('api/account/loginGoogle', 'post', { token: token }).then(\n        (res) => {\n          // console.log(res);\n          isExistedAccount = res.isExistedAccount;\n        },\n      );\n      if (!isExistedAccount) {\n        const payload = {\n          username: profileData.googleId,\n          password: profileData.email + 'ToLiShop',\n          photo: profileData.imageUrl,\n          name: profileData.name,\n          email: profileData.email,\n        };\n        const { data } = await api.signUp(payload);\n      }\n      // handle login\n      const { data } = await api.signIn({\n        username: profileData.googleId,\n        password: profileData.email + 'ToLiShop',\n      });\n      setToken(data.access_jwt_token);\n      dispatch(authenticate({ access_jwt_token: data.access_jwt_token }));\n\n      // sign up data in database\n      // const { res } = await api.signUp(form);\n      // // console.log(res);\n      // if (!res) {\n      //   dispatch(setSnackbar(true, 'error', 'Đã có lỗi xảy ra'));\n      // } else {\n      //   // account is exsited\n      //   if (res.message != 'successfully created') {\n      //     dispatch(setSnackbar(true, 'error', 'Tên đăng nhập đã tồn tại!'));\n      //   } else {\n      //     const { res } = await api.signIn(form);\n      //     setToken(res.access_jwt_token);\n      //     dispatch(authenticate({ access_jwt_token: res.access_jwt_token }));\n      //   }\n      // }\n\n      // history.push('/');\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const googleError = () => {\n    alert('Đã có lỗi xảy ra trong quá trình đăng nhập. Thử lại sau!');\n  };\n\n  const handleChange = (e) =>\n    setForm({ ...form, [e.target.name]: e.target.value });\n\n  return (\n    <Container component=\"main\" maxWidth=\"xs\">\n      <Paper className={classes.paper} elevation={3}>\n        <Avatar className={classes.avatar}>\n          <LockOutlinedIcon />\n        </Avatar>\n        <Typography variant=\"h5\">\n          {isSignedUp ? 'Đăng kí' : 'Đăng nhập'}\n        </Typography>\n        <form className={classes.form} onSubmit={handleSubmit}>\n          <Grid container spacing={2}>\n            {isSignedUp && (\n              <Input\n                name=\"name\"\n                label=\"Họ tên\"\n                autoFocus\n                handleChange={handleChange}\n              />\n            )}\n            <Input\n              name=\"username\"\n              label=\"Tên đăng nhập\"\n              type=\"text\"\n              handleChange={handleChange}\n            />\n            <Input\n              name=\"password\"\n              label=\"Mật khẩu\"\n              type={showPassword ? 'text' : 'password'}\n              handleShowPassword={handleShowPassword}\n              handleChange={handleChange}\n            />\n            {isSignedUp && (\n              <Input\n                name=\"confirmPassword\"\n                label=\"Repeat Password\"\n                // handleChange={handleChange}\n                type=\"password\"\n                handleChange={handleChange}\n              />\n            )}\n          </Grid>\n          <Button\n            type=\"submit\"\n            fullWidth\n            variant=\"contained\"\n            color=\"primary\"\n            className={classes.submit}\n          >\n            {isSignedUp ? 'Đăng kí' : 'Đăng nhập'}\n          </Button>\n          <GoogleLogin\n            clientId=\"760325754105-f20dtj8ttufvs00sufb4sc9fniq83apk.apps.googleusercontent.com\"\n            render={(renderProps) => (\n              <Button\n                className={classes.googleButton}\n                color=\"primary\"\n                fullWidth\n                onClick={renderProps.onClick}\n                disabled={renderProps.disabled}\n                startIcon={<Icon />}\n                variant=\"contained\"\n              >\n                Đăng nhập Google\n              </Button>\n            )}\n            onSuccess={googleSuccess}\n            onFailure={googleError}\n            cookiePolicy=\"single_host_origin\"\n          />\n          <Grid container justify=\"flex-end\">\n            <Grid item>\n              <Button onClick={switchMode}>\n                {isSignedUp\n                  ? 'Đã có tài khoản? Đăng nhập'\n                  : 'Chưa có tài khoản? Đăng kí'}\n              </Button>\n            </Grid>\n          </Grid>\n        </form>\n      </Paper>\n    </Container>\n  );\n};\n\nexport default Login;\nLogin.propTypes = {\n  setToken: PropTypes.func.isRequired,\n};\n"]},"metadata":{},"sourceType":"module"}